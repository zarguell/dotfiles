# Dotfiles (Codespaces + zsh)

Personal dotfiles for GitHub Codespaces (Ubuntu) and local shells.

This repo is optimized for:

- zsh as the default shell
- a fast “modern UNIX tools” CLI toolkit (bat/eza/rg/fd/zoxide/duf/dust/procs/etc.)
- Powerlevel10k (p10k) prompt
- rustup-managed Rust (to avoid `cargo install` failures caused by old Ubuntu rustc)

## How Codespaces uses this repo

When you select a dotfiles repository in GitHub Codespaces settings and enable “Automatically install dotfiles”, Codespaces clones your dotfiles repo and runs `install.sh` (if present + executable). Changes apply to **new** codespaces.  
Docs: <https://docs.github.com/en/codespaces/setting-your-user-preferences/personalizing-github-codespaces-for-your-account>

## Files

- `install.sh`
  - Installs packages via `apt`
  - Ensures rustup is installed and used as the primary Rust toolchain
  - Installs Rust-based CLIs via `cargo install` only when missing
  - Clones Powerlevel10k
  - Symlinks dotfiles into `$HOME`
  - Optionally persists Rust/cargo caches under `/workspaces/.persist`

- `.zshrc` / `.bashrc`
  Minimal entrypoints that source the real config from `~/.config/shell/`.

- `.config/shell/common.sh`
  Shared aliases + PATH + shared env vars (bash + zsh).

- `.config/shell/zsh.sh`
  zsh-only config + Powerlevel10k load.

- `.config/shell/bash.sh`
  bash-only config (history + fzf bindings).

- `.p10k.zsh`
  Generated by `p10k configure` and committed so prompts are consistent.

## Powerlevel10k setup

In a zsh terminal:

- `exec zsh`
- `p10k configure`

This writes `~/.p10k.zsh`. Commit it into this repo as `.p10k.zsh`.

### VS Code terminal font (important)

Set:

- `terminal.integrated.fontFamily` = `MesloLGS NF`

Powerlevel10k font guide:
<https://github.com/romkatv/powerlevel10k/blob/master/font.md>

## Persistent storage strategy (Codespaces)

This repo optionally persists Rust toolchains/caches under:

- `/workspaces/.persist/`

## Rust updates (intentional behavior)

To keep setup fast and deterministic, `install.sh` is written to avoid downloading/updating the Rust toolchain on every run.

- If `stable` is already installed, `install.sh` will not update it automatically.
- If a Rust-based CLI requires a newer compiler, update manually:

```shell
rustup update stable
```

You can also check or change the default toolchain:

```shell
rustup default
rustup default stable
```

## Troubleshooting

- Dotfiles clone path (common):
  `/workspaces/.codespaces/.persistedshare/dotfiles`

- If `p10k` is “command not found”, ensure zsh has sourced Powerlevel10k:
  `source ~/.local/share/powerlevel10k/powerlevel10k.zsh-theme`
  then `exec zsh`
